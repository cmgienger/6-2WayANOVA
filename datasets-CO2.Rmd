---
title: "2-Way ANOVA"
output: html_notebook
---
Practice using dplyr to summarise data; ggplot2 to make visualization.
Use the built-in CO2 dataset; don't need to load any library to access.
**Ignore that data are repeated sample of a handful of individual plants.**

```{r setup}
library(dplyr)
library(ggplot2)
library(emmeans)
```
**CO2 Example**
```{r}
#find out more information about the CO2 dataset (built into R)
?CO2
```
Details

The CO2 uptake of six plants from Quebec and six plants from Mississippi was measured at several levels of ambient CO2 concentration. Half the plants of each type were chilled overnight before the experiment was conducted.

Source

Potvin, C., Lechowicz, M. J. and Tardif, S. (1990) “The statistical analysis of ecophysiological response curves obtained from experiments involving repeated measures”, Ecology, 71, 1389–1400.

Pinheiro, J. C. and Bates, D. M. (2000) Mixed-effects Models in S and S-PLUS, Springer.
```{r}
data<-CO2
```

```{r}
summary_data<-data %>%
  group_by(Type, Treatment) %>%
  summarise(
    mean_uptake=mean(uptake),
    sd_uptake=sd(uptake),
    n=n(),
    se_uptake=sd(uptake)/sqrt(n)
  )
summary_data
```

```{r}
ggplot(summary_data, aes(x=Type, y=mean_uptake, fill=Treatment)) +
  geom_bar(stat="identity", color="black", position=position_dodge()) +
  geom_errorbar(aes(ymin=mean_uptake-se_uptake, ymax=mean_uptake+se_uptake), width=.2, position=position_dodge(.9))+
  ylab("CO2 uptake rates (umol/m^2 sec)")+
  theme_bw()
```
Making this figure is not as intuitive as you might think because of the position dodge required, 
the stat="identity", and error bar specification.
Really messes up things; not an intuitive intro example.
Note that the reference group in the model summary table is the mean of Quebec non-chilled. Everything else is in reference to that.

```{r}
model1 <- lm(uptake~Type*Treatment, data=data)
anova(model1)
```

```{r}
summary(model1)
```
```{r}
#Multiple Contrasts using EMmeans package
emm_model1<- emmeans(model1, "Type", "Treatment")
pairs(emm_model1)
```

```{r}
#visually compare marginal means (LS means)
plot(emm_model1, comparisons = TRUE)+
  coord_flip()
```
Because there are two treatments, it breaks them into two panels.
```{r}
#connecting letters differences report
multcomp::cld(emm_model1)
```

Simple Contrasts
```{r}
contrast(emm_model1, "consec", simple = "each", combine = TRUE, adjust = "mvt")
```
Pairwise P-value plots; pwpp plots
```{r}
model.cells <- emmeans(model1, ~ Type * Treatment)
pwpp(model.cells, type = "response")
```




